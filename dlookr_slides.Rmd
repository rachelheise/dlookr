---
title: "dlookr Package"
subtitle: "WCM Computing Club - September 22, 2022"
author: "Rachel Heise"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["xaringan-themer.css","extra.css"]
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    seal: false 
editor_options: 
  chunk_output_type: console
---

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
library(fontawesome)
library(kableExtra)
library(dplyr)
library(dlookr)
style_mono_accent(
  base_color = "#1c5253",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "300", "300i"),
  code_font_google   = google_font("Fira Mono")
  )
```

```{r, include = F}
# This is the recommended set up for flipbooks
# you might think about setting cache to TRUE as you gain practice --- building flipbooks from scratch can be time consuming
knitr::opts_chunk$set(fig.width = 9, message = FALSE, warning = FALSE, comment = "", cache = F) #,
                      # class.output = "pre")

library(flipbookr)
library(tidyverse)
library(rmarkdown)
library(data.table)
```

layout: true
background-image: url(img/dlookr_hex.png)
background-size: 80px
background-position: 95% 95%

---

name: xaringan-title
class: left, middle
background-image: url(img/white-abstract-background.jpg)
background-size: cover

<h1 style="color: gray;">Data diagnosis, exploration, and transformation with {dlookr}</h1>

<img src="img/dlookr_hex.png" alt="dlookr-hex-sticker" width="180" />

<h3 style="color: gray;">Rachel Heise | WCM Computing Club | September 22, 2022</h3>

---

# dlookr

- Package for exploratory data analysis

  - Data diagnosis
  
  - Exploration
  
  - Transformation
  
---


# Advantages of dlookr

- Seamless integration with `dplyr`

- Use of `plot` and `summary` functions to quickly view diagnostic data

- Simple and powerful commands
  
---

# Data
.pull-left[
- Use `iris` dataset...with some NAs added for complexity

- `iris` variables

  - Sepal Length (continuous, add NA)
  
  - Sepal Width (continuous)
  
  - Petal Length (continuous)
  
  - Petal Width (continuous)
  
  - Species (categorical, add NA)
    
]

--

.pull-right[
```{r}
data("iris")

iris["Sepal.Length"] <- lapply(iris["Sepal.Length"], function(x) {x[sample( c(1:40), floor(40/10))] <- NA; x})
iris["Species"] <- lapply(iris["Species"], function(x) {x[sample( c(1:35), floor(35/10))] <- NA; x})

iris %>% data.table()
```
]

---

# Diagnose
.pull-left[
  - `diagnose` function describes:
  
    - the type of each variable
    
    - number & percent of missing data
    
    - unique data
    
  - Helps with basic data diagnostics: are unique counts what you expect, how much missingness is there, are data types correct

]

--

.pull-right[
```{r}
diagnose(iris)
```
]

---

# Diagnose

.pull-left[

- `diagnose` outputs a dataframe

- This dataframe can be used with `dplyr` to perform any operations, including sorting and filtering

]

.pull-right[
```{r}
iris %>% 
  diagnose() %>% 
  select(-unique_count, -unique_rate) %>% 
  filter(missing_count > 0) %>% 
  arrange(desc(missing_count))
```
]
---

# Diagnose Continuous Variables
```{r}
diagnose_numeric(iris)
```

--
```{r}
diagnose_outlier(iris)
```

--
```{r}
diagnose_outlier(iris) %>% 
  filter(outliers_cnt > 0)
```

---
# Plot Outliers
```{r, fig.height = 6, fig.width = 8}
iris %>% 
  plot_outlier(Sepal.Width)
```


---

# Diagnose Categorical Variables

.pull-left[

- `diagnose_category` is used to assess categorical variables including:

  - levels of each categorical variable
  - number of observations for each level
  - percentage of observations at each level
  - rank of each level of a categorical variable

]
--

.pull-right[
```{r}
diagnose_category(iris)
```
]
--
.pull-right[
```{r}
diagnose_category(iris) %>% 
  filter(is.na(levels))
```
]
---

# Describe

.pull-left[

- Compute descriptive statistics for numerical data with `describe`

```{r}
describe(iris)
```
]


--

.pull-right[

- Use with `group_by()` from `dplyr` to assess descriptive statistics by a categorical variable


```{r}
iris %>% 
  group_by(Species) %>% 
  describe(Sepal.Length)
```
]

---

# Normality

.pull-left[

- Assess normality of continuous variables and plot log and sqrt transformations

```{r}
normality(iris)
```
]
--
.pull-right[
```{r, fig.height=4, fig.width = 6}
iris %>% 
  plot_normality(Petal.Length)
```
]
---
# Correlation
.pull-left[
```{r}
correlate(iris)
```
]
--
.pull-right[
```{r, fig.width=5, fig.height=5}
iris %>% 
  correlate() %>% 
  plot()
```
]
---
# Target Variables

.pull-left[

- Similar to `group_by()` in `dplyr`

- Target variables are used to explore the relationship between a categorical variable and other variable values

]
--
.pull-right[

```{r, fig.height=5, fig.width=6}
categ <- target_by(iris, Species) # Species is the target variable
cat_num <- relate(categ, Petal.Length) # petal length is the numerical variable of interest

plot(cat_num)
```

]

---
# Imputation - continuous

.pull-left[

- Imputation methods for continuous variables include:

  - mean
  - median
  - mode
  - K-nearest neighbors (knn) 
  - Recursive Partitioning and Regression Trees (rpart)
  - Multivariate Imputation by Chained Equations (mice)
  

]
---
# Imputation - continuous
.pull-left[
```{r}
sepallength_im <- imputate_na(iris, Sepal.Length, yvar = Species, method = "knn")

x = summary(sepallength_im)
```
]
--
.pull-right[
```{r, fig.height = 4, fig.width = 6}
plot(sepallength_im)

# add imputed variable to original data set

iris_new <- cbind(iris, sepallength_im)
```
]
---

# Imputation - categorical 
.pull-left[
- Imputation for categorical variables include:

  - mode
  - Recursive Partitioning and Regression Trees (rpart)
  - Multivariate Imputation by Chained Equations (mice)
]

.pull-right[

```{r}
library(mice)
species_im <- imputate_na(iris, Species, method = "mice")

plot(species_im)

summary(species_im)
iris_new <- cbind(iris, species_im)
```

]

---
# Imputation - outliers

.pull-left[

- Imputation methods for outliers

  - mean
  - median
  - mode
  - capping (imputes upper outliers at 95th percentile and lower outliers at 5th percentile)

]
---
# Imputation - outliers
.pull-left[
```{r}
iris_outliers <- imputate_outlier(iris, Sepal.Width, method="capping")
iris_outliers
```
]
--

.pull-right[
```{r, fig.height=4, fig.width=6}
plot(iris_outliers)
```
]

---
# Standardization and Skewness

.pull-left[
- `transform` function can both standardize (using z-score or minmax methods) and resolve skewness (via various transformations).
]

--
.pull-right[
```{r, warning=FALSE, fig.width=6, fig.height=4}
iris_t <- transform(iris$Sepal.Length, method = "minmax")

plot(iris_t)
```
]
---
# Find Skewness
.pull-left[
- `find_skewness` function identifies skewed variables. Use `index=FALSE` argument to return the names of the skewed variables.
]
--
.pull-right[
```{r}
find_skewness(iris, index = FALSE)
find_skewness(iris, value = TRUE)
#filter on level of skewness
find_skewness(iris, value = TRUE, thres = 0.3)
```
]
---
# Binning

.pull-left[
- `binning` transforms a continuous variable into a categorical variable.

- It includes the following types of binning:

  - quantile
  - equal
  - pretty (?)
  - kmeans
  - bclust
]

--

.pull-right[
```{r}
bin <- binning(iris$Petal.Length,
               nbins = 4,
               type = "kmeans",
               labels = c("B1", "B2", "B3", "B4")) #default type is quantile
bin
```
]
---

# Binning plot
.pull-left[
```{r}
summary(bin)
```
]

.pull-right[
```{r, fig.height = 5, fig.width=6}
plot(bin)
```
]


```{css, eval = TRUE, echo = FALSE}
.remark-code{line-height: 1.5; font-size: 60%}

pre {
  max-width: 600px;
  max-height: 300px;
  overflow-x: auto;
  overflow-y: scroll;
  font-weight: 300;
  font-style: initial;
}

```





